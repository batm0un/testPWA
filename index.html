<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>test2</title>
	<link rel="manifest" href="/testPWA/test.webmanifest.aspx">
<script>
// Initialize deferredPrompt for use later to show browser install prompt.
var deferredPrompt;

window.onbeforeinstallprompt = function(e) {
	// Prevent the mini-infobar from appearing on mobile
	e.preventDefault();
	// Stash the event so it can be triggered later.
	deferredPrompt = e;
	// Update UI notify the user they can install the PWA
	showInstallPromotion();
	// Optionally, send analytics event that PWA install promo was shown.
	console.log(`'beforeinstallprompt' event was fired.`);

};

function showInstallPromotion(){
	if(window.localStorage.getItem("AppInstallChoice") !=null){ return;}
	
	var installButton=document.querySelectorAll("#installApp")[0];
	installButton.style.display='block';

	installButton.addEventListener('click',function(e){
	  // deferredPrompt is a global variable we've been using in the sample to capture the `beforeinstallevent`
	  deferredPrompt.prompt();
	  deferredPrompt.userChoice.then(function(resp){
		  var outcome=resp.outcome;
		  window.localStorage.setItem("AppInstallChoice",outcome);
		  deferredPrompt = null;
		  // Act on the user's choice
		  if (outcome === 'accepted') {
			   hideInstallPromotion();
		    console.log('User accepted the install prompt.');
		  } else if (outcome === 'dismissed') {
			   hideInstallPromotion();
		    console.log('User dismissed the install prompt');
		  }	  
	  });
	 
	});
}
function hideInstallPromotion(){
	document.querySelectorAll("#installApp")[0].style.display='none';
}

	
</script>

</head>
<body> 
	<h1>TEST 1.00</h1>

<div id="installApp" style="display: none;cursor:pointer;position: absolute;width: 100vw;background-color: lightgrey;height: 40px;line-height: 40px;text-align: center;position: fixed;bottom: 0px;left: 0px;">
    Install the application
</div>
</body>
</html>
